<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ğŸ· ç™»å…¥ç•Œé¢</title>
    {% load static %}
    <script src="{% static 'jquery-3.4.1/jquery.min.js' %}"></script>
    <link href="{% static 'bootstrap-3.3.7/css/bootstrap.min.css' %}" rel="stylesheet">
    <script src="{% static 'bootstrap-3.3.7/js/bootstrap.min.js' %}"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <style>
        body{
            background-image: url("{% static 'img/22.jpg' %}");
        }
        .c1{
            margin-top: 150px;
            background: rgba(0,0,0,0.3);
            padding-top: 50px;
            padding-bottom: 35px;
        }
        .c2{
            background: rgba(255,255,255,0.20);
            border: 0;
            width: 400px;
            margin: auto;
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row c1">
        <div class="col-md-4 col-md-offset-4">
            <div class="panel panel-info c2">
              <div class="panel-heading text-center">
                <h3 class="panel-title">ç™»å…¥</h3>
              </div>
              <div class="panel-body">
                  <form id="my_form">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="">ç”¨æˆ·å</label>
                            <input type="text" id="id_username" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="">å¯†ç </label>
                            <input type="password" id="id_password" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="">éªŒè¯ç </label>
                            <div class="row">
                                {# éªŒè¯ç è¾“å…¥æ¡† #}
                                <div class="col-md-6">
                                    <input type="text" id="id_code" class="form-control">
                                </div>
                                {# éªŒè¯ç å›¾ç‰‡ #}
                                <div class="col-md-6">
                                    <img src="{% url 'get_valid_code' %}" alt="" height="31px" width="100%" id="id_img">
                                </div>
                            </div>
                        </div>
                  </form>
                  <input type="submit" value="ç™»å…¥" class="btn btn-block btn-warning" id="id_submit"><br>
                  <a href="{% url 'register_name' %}" class="btn btn-block btn-warning">æ³¨å†Œ</a><br>
                  <a href="{% url 'home_name' %}" class="btn btn-block btn-warning">é¦–é¡µé€›é€›</a>
              </div>
            </div>
        </div>
    </div>
</div>

<script>
    // ä¸ºéªŒè¯ç å›¾ç‰‡ç»‘å®šç‚¹å‡»äº‹ä»¶,ç‚¹å‡»ä¸€æ¬¡åˆ·æ–°ä¸€æ¬¡
    $('#id_img').click(function () {
        var img_url = $(this)[0].src
        // åªæœ‰æ¯æ¬¡å›¾ç‰‡è·¯å¾„æ”¹å˜çš„æ—¶å€™å†ä¼šå‘åç«¯å‘èµ·è¯·æ±‚,æ¯æ¬¡åŠ ?å·è§£å†³
        $(this).attr('src',img_url+'?')
    })
    $('#id_submit').click(function () {
        $.ajax({
            url:'{% url 'login_name' %}',
            method:'post',
            data:{
                username:$('#id_username').val(),
                password:$('#id_password').val(),
                code:$('#id_code').val(),
                csrfmiddlewaretoken:'{{ csrf_token }}'
            },
            success:function (data) {
                if (data.status === 200){
                    $('#id_password').val(''),
                    $('#id_code').val(''),
                    swal({
                      title:data.msg,
                      text:' ',
                      icon: "success",
                      buttons: false,
                      dangerMode: true,
                    })
                    .then(setTimeout(function () {
                        location.href=data.next_url
                    },1000)
                    );
                }else{
                    swal({
                      title: 'ç™»å…¥å¤±è´¥!',
                      text: data.msg,
                      icon: "warning",
                      buttons: ["å‰å¾€æ³¨å†Œ", "ç»§ç»­ç™»å…¥"],
                      dangerMode: true,
                    })
                    .then((willDelete) => {
                      if (willDelete) {
                        location.href='{% url 'login_name' %}'
                      } else {
                        location.href='{% url 'register_name' %}'
                      }
                    });
                }
            }
        })
    })
</script>
</body>
</html>