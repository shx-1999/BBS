{% extends 'register.html' %}
{% load static %}

{% block title %}
    ğŸ¦¢ä¿®æ”¹å¯†ç 
{% endblock %}


{% block css %}
    body{
    background-image: url("{% static 'img/27.jpg' %}");
    }
    .c1 {
    margin-top: 120px;
    background: rgba(0, 0, 0, 0.3);
    padding-top: 20px;
    }
    .c2 {
    background: rgba(255, 255, 255, 0.2);
    border: 0;
    width: 400px;
    margin: auto;
    margin-bottom:20px;
    }
{% endblock %}

{% block body %}
    <div class="panel-heading text-center">
        <h3 class="panel-title">ä¿®æ”¹å¯†ç </h3>
    </div>
    <div class="panel-body">
        <form id="my_form">
            {% csrf_token %}
            <div class="form-group">
                <label for="id_password1">åŸå¯†ç </label>
                <input type="password" name="password1" class="form-control" maxlength="18" minlength="3" required=""
                       id="id_password1">
            </div>
            {% for foo in passwd_forms %}
                <div class="form-group">
                    <label for="{{ foo.auto_id }}">{{ foo.label }}</label>
                    {{ foo }}
                </div>
            {% endfor %}
        </form>
        <input type="submit" value="æäº¤" class="btn btn-block btn-warning" id="id_submit"><br>
        <a href="{% url 'home_name' %}" class="btn btn-block btn-warning">å–æ¶ˆ</a><br>
    </div>
{% endblock %}



{% block script %}
{#    <script>#}
        // ç‚¹å‡»æŒ‰é’®,formè¡¨å•
        $('#id_submit').click(function () {
            // ajaxè¯·æ±‚æäº¤æ•°æ®
            $.ajax({
                url: '{% url 'passwd_change_name' %}',
                method: 'post',
                data: {
                    'password1': $('#id_password1').val(),
                    'password': $('#id_password').val(),
                    're_password': $('#id_re_password').val(),
                    'csrfmiddlewaretoken':'{{ csrf_token }}',
                },
                success: function (data) {
                    if (data.status === 100) {
                        swal({
                            title: data.msg,
                            text: 'è·³è½¬ç™»å…¥é¡µé¢é‡æ–°éªŒè¯...',
                            icon: "success",
                            dangerMode: true,
                        }).then(function () {
                            location.href = '{% url 'login_name' %}';
                        })
                    } else {
                        // é”™è¯¯çš„ç»“æœè¿”å›errorså­—å…¸,æ ¼å¼:{'username': [é”™è¯¯ä¿¡æ¯1,é”™è¯¯ä¿¡æ¯2,...], ...}
                        $.each(data.msg, function (key, value) {
                            // é”™è¯¯çš„æ¡†æ·»åŠ çº¢è‰²è¾¹æ¡†
                            $('#id_' + key).parent().addClass('has-error')
                            swal({
                                title: 'æ“ä½œå¤±è´¥!',
                                text: value[0],
                                icon: "warning",
                                dangerMode: true,
                            })
                        })
                    }
                }
            })
        })
        // å½“ç”¨æˆ·ç‚¹å‡»è¾“å…¥æ¡†æ—¶æ¸…é™¤has-erroræ•ˆæœ(èšç„¦)(æˆ–è€…ä½¿ç”¨å®šæ—¶å™¨)
        $('input').focus(function () {
            $('.form-group').removeClass('has-error')
        })
{#    </script>#}
{% endblock %}